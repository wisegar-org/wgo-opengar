(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"499c":function(t,e,l){"use strict";l("8597")},"5ddd":function(t,e,l){"use strict";l.r(e);var i=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("Bills")},o=[],s=l("60a3"),a=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{staticClass:"q-pa-md",staticStyle:{width:"100%"}},[t.userLogged&&t.userLogged.isAdmin?l("q-table",{attrs:{bordered:"",flat:"",title:"",data:t.filterBills,columns:t.columns,"row-key":"nameBill",loading:t.loading},scopedSlots:t._u([{key:"top",fn:function(){return[l("div",{staticClass:"row items-center justify-between q-table"},[l("div",{staticClass:"col-12 col-sm-auto no-wrap"},[l("div",{staticClass:"q-table__title ellipsis"},[t._v("\n            Bills\n          ")])]),l("div",{staticClass:"flex q-pb-sm justify-end col-12 col-sm-auto row"},[l("q-btn",{staticClass:"col-12 col-sm-auto q-ml-sm q-mb-sm",attrs:{unelevated:"",color:"primary",icon:"add",label:"Create Bill","no-caps":""},on:{click:function(){return t.showEditBillDialog(null)}}}),t.userLogged&&t.userLogged.isAdmin?l("q-btn",{staticClass:"col-12 col-sm-auto q-ml-sm q-mb-sm",attrs:{unelevated:"",color:"primary",icon:"settings",label:"Bill Template","no-caps":""},on:{click:t.goToBillTemplate}}):t._e()],1)]),l("div",{staticClass:"row q-col-gutter-none justify-end",staticStyle:{width:"100%"}},[l("div",{staticClass:"col-12 col-md-3"},[l("FilterSelect",{attrs:{label:"Status",options:t.statusOptions,filterProp:"label",value:t.filter.status},on:{onChange:function(e){t.setStatus(e)}}})],1),l("div",{staticClass:"col-12 col-md-3"},[l("q-input",{attrs:{clearable:"",dense:"",outlined:"",prefix:"Client: "},model:{value:t.clientBill,callback:function(e){t.clientBill=e},expression:"clientBill"}})],1)])]},proxy:!0},{key:"loading",fn:function(){return[l("Loader",{attrs:{loading:!0}})]},proxy:!0},{key:"body-cell-buttons",fn:function(e){return[l("q-td",{attrs:{props:e}},[l("div",[l("q-btn",{attrs:{unelevated:"",color:"primary",icon:"more_vert",dense:""}},[l("q-menu",[l("q-list",{staticStyle:{"min-width":"100px"}},[l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.showBillDialog(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"assignment"}})],1),l("q-item-section",[t._v("Details")])],1),3!==e.row.status?l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.showEditBillDialog(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"edit"}})],1),l("q-item-section",[t._v("Edit")])],1):t._e(),1===e.row.status||2===e.row.status?l("q-separator"):t._e(),1===e.row.status||2===e.row.status?l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.setConfirmStatusDialog(e.row,!0)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"monetization_on"}})],1),l("q-item-section",[t._v("Pay")])],1):t._e(),1===e.row.status||2===e.row.status?l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.setConfirmStatusDialog(e.row,!1)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"cancel"}})],1),l("q-item-section",[t._v("Cancel")])],1):t._e(),4!==e.row.status?l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.sendBillLink(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"email"}})],1),l("q-item-section",[t._v("Send Bill")])],1):t._e(),4!==e.row.status?l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.loadBillPreview(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"visibility"}})],1),l("q-item-section",[t._v("Preview")])],1):t._e()],1)],1)],1)],1)])]}}],null,!1,1391059814)}):t._e(),l("AddBillEditorDialog",{attrs:{billToEdit:t.selectedBill,showModal:t.showAddBillDialog,close:function(){return t.showAddBillDialog=!1}}}),l("ViewerBillDialog",{attrs:{bill:t.selectedBill,showModal:t.showViewBillDialog,close:function(){return t.showViewBillDialog=!1}}}),l("ConfirmDialog",{attrs:{icon:"attach_money",showModal:t.showConfirmStatusDialog,cancelButton:"Cancel",okButton:"Confirm",text:t.textConfirm,onConfirm:function(){return t.changeStatus(!0)},onClose:function(){return t.showConfirmStatusDialog=!1}}})],1)},n=[],r=l("4bb5"),c=l("127a"),d=l("7155");const u={name:"nameBill",required:!0,label:"Name",align:"left",field:"name",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},p={name:"clientBill",align:"left",label:"Client",field:t=>t.client.name,sortable:!0,classes:"ellipsis",style:"max-width: 250px"},b={name:"totalPriceBill",label:"Total Price",field:t=>t.totalPrice!==t.totalWithDiscount?`${t.totalWithDiscount} ( ${t.totalPrice} )`:`${t.totalPrice}`,align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},m={name:"countProductBill",label:"Count Products",field:t=>t.products.length.toString(),align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},h={name:"statusBill",label:"Status",field:t=>Object(d["c"])(t.status),align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},f={name:"buttons",label:"",align:"",field:"name",style:"max-width: 100px"},v=[u,p,b,m,h,f],g={name:"productBillName",label:"Poduct",field:t=>t.product.name,align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},y={name:"productBillSellPrice",label:"Sell Price",field:t=>t.product.sellPrice.toString(),align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},w={name:"productBillCount",label:"Count",field:t=>1===t.type?`${t.count} unit${t.count>0?"s":""}`:`${t.count} hours`,align:"left",sortable:!0,classes:"ellipsis",style:"max-width: 100px"},B=[g,y,w,f];var P=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("Dialog",{attrs:{showModal:t.showModal,loading:t.showLoading,title:t.getTitle(),close:function(){return t.onClose()},styleDialog:"width: 800px; max-width: 90vw"}},[l("template",{slot:"content"},[l("AddBillEditor",{attrs:{billToEdit:t.billToEdit,close:function(){return t.onClose()},showLoading:function(e){return t.showLoading=e}}})],1)],2)},q=[],C=function(){var t=this,e=t.$createElement,l=t._self._c||e;return t.bill?l("div",[l("q-input",{staticClass:"q-mx-md q-mb-lg q-mt-md",attrs:{square:"",outlined:"",label:"Name",autofocus:!0,dense:""},model:{value:t.bill.name,callback:function(e){t.$set(t.bill,"name",e)},expression:"bill.name"}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",label:"Description",autogrow:"",dense:""},model:{value:t.bill.description,callback:function(e){t.$set(t.bill,"description",e)},expression:"bill.description"}}),l("div",{staticClass:"q-mx-md q-my-lg"},[l("FilterSelect",{attrs:{clearable:!1,label:"Client",options:t.getValidCollaborators(),filterProp:"login",value:t.bill.client},on:{onChange:function(e){return t.setCollaborator(e)}}})],1),l("div",{staticClass:"q-px-md q-pb-lg",staticStyle:{width:"100%"}},[l("q-table",{attrs:{bordered:"",flat:"",title:"",data:Object.values(t.billProducts).filter((function(t){return!t.remove})),columns:t.columns,"row-key":"productBillName","no-data-label":"Please, add some product to bill"},scopedSlots:t._u([{key:"top",fn:function(){return[l("div",{staticClass:"row q-col-gutter-none justify-between q-pa-none",staticStyle:{width:"100%"}},[l("div",{staticClass:"self-center"},[t._v("\n            Products\n          ")]),l("div",[l("q-btn",{attrs:{unelevated:"",padding:"sm",color:"primary",icon:"add",size:"sm","no-caps":""},on:{click:function(){return t.setShowAddEditProductBillDialog(null)}}})],1)])]},proxy:!0},{key:"loading",fn:function(){return[l("Loader",{attrs:{loading:!0}})]},proxy:!0},{key:"body-cell-buttons",fn:function(e){return[l("q-td",{attrs:{props:e}},[l("div",[l("q-btn",{attrs:{unelevated:"",color:"primary",icon:"more_vert",dense:""}},[l("q-menu",[l("q-list",{staticStyle:{"min-width":"100px"}},[l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.setShowAddEditProductBillDialog(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"edit"}})],1),l("q-item-section",[t._v("Edit")])],1),l("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(l){return t.onDeleteProduct(e.row)}}},[l("q-item-section",{attrs:{avatar:""}},[l("q-avatar",{attrs:{icon:"delete"}})],1),l("q-item-section",[t._v("Delete")])],1)],1)],1)],1)],1)])]}}],null,!1,745764449)})],1),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",label:"Discount",type:"number",dense:"",rules:[function(t){return parseInt(t)<=100&&parseInt(t)>=0||"Invalid value."}]},model:{value:t.bill.discount,callback:function(e){t.$set(t.bill,"discount",e)},expression:"bill.discount"}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",value:t.getPrice(),label:"Bill Total Price",readonly:"",autogrow:"",dense:""}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",label:"Valid Days",type:"number",dense:""},model:{value:t.bill.validDays,callback:function(e){t.$set(t.bill,"validDays",e)},expression:"bill.validDays"}}),t.isUpdateBill?l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{dense:"",outlined:"",mask:"date",label:"Send date"},scopedSlots:t._u([{key:"append",fn:function(){return[l("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[l("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[l("q-date",{model:{value:t.bill.sendDate,callback:function(e){t.$set(t.bill,"sendDate",e)},expression:"bill.sendDate"}},[l("div",{staticClass:"row items-center justify-end"},[l("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{unelevated:"",label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}],null,!1,852169773),model:{value:t.bill.sendDate,callback:function(e){t.$set(t.bill,"sendDate",e)},expression:"bill.sendDate"}}):t._e(),l("QEditor",{staticClass:"q-mx-md q-my-lg",attrs:{toEdit:t.bill,propToEdir:"observations",label:"Observations"}}),l("MediaListEditor",{attrs:{items:t.bill.docs,addItems:function(e){t.docsToAdd=e},title:"Bild documents",changeValue:function(){},showLoading:t.showLoading}}),l("q-card-section",{staticClass:"row text-primary items-center justify-center q-mt-md"},[l("q-btn",{staticClass:"col-12 col-sm-auto",attrs:{unelevated:"",color:"primary",align:"around",disable:!t.isValid(),label:t.isUpdateBill?"Update":"Create"},on:{click:function(){return t.addBillClick()}}})],1),l("AddProductBillDialog",{attrs:{close:function(){return t.showAddEditProductBillDialog=!1},showModal:t.showAddEditProductBillDialog,productBill:t.selectedProductBill,addProduct:t.addProductToBill,products:t.getProductsList(t.selectedProductBill)}})],1):t._e()},O=[],D=l("04f3"),x=l("7c62"),j=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("Dialog",{attrs:{showModal:t.showModal,loading:t.showLoading,title:"Config prodoct to bill",close:function(){return t.onClose()},styleDialog:"width: 400px; max-width: 80vw"}},[l("template",{slot:"content"},[l("AddProductBill",{attrs:{products:t.products,productBill:t.productBill,close:function(){return t.onClose()},showLoading:function(e){return t.showLoading=e},addProduct:t.addProduct}})],1)],2)},S=[],E=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("div",{staticClass:"q-ma-lg"},[l("FilterSelect",{attrs:{clearable:!1,label:"Product",options:t.products,filterProp:"name",value:t.productInBill.product},on:{onChange:function(e){return t.setProducts(e)}}})],1),t.productInBill.productId?l("q-input",{staticClass:"q-ma-lg",attrs:{square:"",outlined:"",value:t.productInBill.product.sellPrice,type:"number",label:"Sell Price",readonly:"",dense:""}}):t._e(),l("q-input",{staticClass:"q-ma-lg",attrs:{square:"",outlined:"",prefix:t.getPrefixCount(),suffix:t.getSuffixCount(),type:"number",label:"Count",dense:"",rules:[function(t){return t>0||"* Required"},function(e){return 1!==t.productInBill.type||e<=t.productInBill.maxCount||"Max count: "+t.productInBill.maxCount}]},model:{value:t.productInBill.count,callback:function(e){t.$set(t.productInBill,"count",e)},expression:"productInBill.count"}}),l("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[l("q-btn",{staticClass:"btn-fixed-width btn_width",attrs:{unelevated:"",color:"primary",align:"around",disable:!t.isValid(),label:t.isUpdateBill?"Update":"Add"},on:{click:function(){return t.addProductToBillClick()}}})],1)],1)},k=[],I=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let _=class extends s["Vue"]{constructor(){super(),this.isUpdateBill=!!this.productBill,this.productInBill=this.isUpdateBill?Object.assign({},this.productBill):{productId:0,count:0,maxCount:0,remove:!1,type:1}}getPrefixCount(){return 1===this.productInBill.type?"No. units":"No. hours"}getSuffixCount(){return 1===this.productInBill.type&&this.productInBill.maxCount?`of ${this.productInBill.maxCount}`:""}setProducts(t){this.productInBill.productId=t.id,this.productInBill.product=t,this.productInBill.type=t.type,this.productInBill.maxCount=t.unitCount,this.productInBill.price=t.sellPrice}isValid(){return this.productInBill.productId&&this.productInBill.count}addProductToBillClick(){this.addProduct&&this.addProduct(this.productInBill)}};I([Object(s["Prop"])()],_.prototype,"close",void 0),I([Object(s["Prop"])()],_.prototype,"showLoading",void 0),I([Object(s["Prop"])()],_.prototype,"productBill",void 0),I([Object(s["Prop"])()],_.prototype,"products",void 0),I([Object(s["Prop"])()],_.prototype,"addProduct",void 0),_=I([Object(s["Component"])({components:{MediaListEditor:D["a"],FilterSelect:x["a"]}})],_);var T=_,L=T,$=l("2877"),Q=l("27f9"),A=l("4b7e"),V=l("9c40"),R=l("eebe"),M=l.n(R),N=Object($["a"])(L,E,k,!1,null,null,null),F=N.exports;M()(N,"components",{QInput:Q["a"],QCardActions:A["a"],QBtn:V["a"]});var U=l("1d08"),z=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let Y=class extends s["Vue"]{constructor(){super(...arguments),this.showLoading=!1}onClose(){this.close&&this.close()}};z([Object(s["Prop"])({default:!1})],Y.prototype,"showModal",void 0),z([Object(s["Prop"])()],Y.prototype,"close",void 0),z([Object(s["Prop"])()],Y.prototype,"productBill",void 0),z([Object(s["Prop"])()],Y.prototype,"products",void 0),z([Object(s["Prop"])()],Y.prototype,"addProduct",void 0),Y=z([Object(s["Component"])({components:{AddProductBill:F,Dialog:U["a"]}})],Y);var W=Y,J=W,G=Object($["a"])(J,j,S,!1,null,null,null),K=G.exports,H=l("ea1a"),X=l("b9c3"),Z=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a},tt=function(t,e,l,i){function o(t){return t instanceof l?t:new l((function(e){e(t)}))}return new(l||(l=Promise))((function(l,s){function a(t){try{r(i.next(t))}catch(e){s(e)}}function n(t){try{r(i["throw"](t))}catch(e){s(e)}}function r(t){t.done?l(t.value):o(t.value).then(a,n)}r((i=i.apply(t,e||[])).next())}))};let et=class extends s["Vue"]{constructor(){var t,e;super(),this.bill={id:0,name:"",description:"",totalPrice:0,clientId:0,discount:0,observations:"",validDays:(null===(t=this.organizationData)||void 0===t?void 0:t.bankValidDays)||30},this.docsToAdd=[],this.billClient=null,this.billProducts={},this.selectedProductBill=null,this.columns=B,this.showAddEditProductBillDialog=!1,this.isUpdateBill=!!this.billToEdit,this.bill=this.isUpdateBill?this.billToEdit:{id:0,name:"",description:"",totalPrice:0,clientId:0,observations:"",discount:0,validDays:(null===(e=this.organizationData)||void 0===e?void 0:e.bankValidDays)||30},this.isUpdateBill&&(this.billProducts=this.getProducts())}getProducts(){const t={};return this.billToEdit&&(this.billClient=this.billToEdit.client,this.billToEdit.products.forEach((e=>{const l=e.product;t[e.productId]=Object.assign(Object.assign({},e),{maxCount:e.count+(l?l.unitCount:0),type:l?l.type:1,remove:!1})}))),t}setCollaborator(t){null!==t?(this.billClient=t,this.bill.clientId=t.id):this.bill.clientId=0}getValidCollaborators(){return this.collaborators}setShowAddEditProductBillDialog(t){this.selectedProductBill=t,this.showAddEditProductBillDialog=!0}addProductToBill(t){this.selectedProductBill&&t.productId!==this.selectedProductBill.productId&&(this.billProducts[this.selectedProductBill.productId].remove=!0),this.billProducts=Object.assign(Object.assign({},this.billProducts),{[t.productId]:t}),this.selectedProductBill=null,this.showAddEditProductBillDialog=!1}getProductsList(t){return this.products.filter((e=>!(e.id in this.billProducts)||this.billProducts[e.id].remove||!!t&&e.id===t.productId))}onDeleteProduct(t){this.billProducts[t.productId].remove=!0}isValid(){return!!this.bill&&!!this.bill.name&&!!this.bill.clientId&&this.billProducts&&Object.values(this.billProducts||{}).filter((t=>!t.remove))}getPrice(){let t=Object.values(this.billProducts).filter((t=>!t.remove)).map((t=>t.count*t.price)).reduce(((t,e)=>t+e),0);t=this.roundNumber(t);const e=parseFloat(`${this.bill.discount}`);if(e){const l=Math.floor(t*e)/100;return`${this.roundNumber(t-l)} ( ${t} )`}return t}addBillClick(){return tt(this,void 0,void 0,(function*(){this.showLoading(!0);const t=Object.values(this.billProducts),e=t.filter((t=>!t.remove)).map((t=>t.count*t.price)).reduce(((t,e)=>t+e),0),l=this.isUpdateBill?yield this.updateBill({id:this.billToEdit.id,name:this.bill.name,description:this.bill.description,totalPrice:this.roundNumber(e),clientId:this.billClient?this.billClient.id:0,products:t,discount:parseFloat(`${this.bill.discount}`),observations:this.bill.observations,sendDate:this.bill.sendDate,validDays:parseInt(`${this.bill.validDays}`),docs:this.docsToAdd}):yield this.addBill({name:this.bill.name,description:this.bill.description,totalPrice:e,clientId:this.billClient?this.billClient.id:0,products:t,discount:parseFloat(`${this.bill.discount}`),validDays:parseInt(`${this.bill.validDays}`),observations:this.bill.observations,docs:this.docsToAdd});this.showLoading(!1),l&&(this.notify({message:`Bill ${this.isUpdateBill?"updated":"created"} successfully`,type:"positive"}),this.close&&this.close())}))}roundNumber(t){return Math.floor(100*t)/100}mounted(){return tt(this,void 0,void 0,(function*(){yield this.loadOrganizationData(),this.isUpdateBill||(this.bill.validDays=this.organizationData.bankValidDays)}))}};Z([Object(s["Prop"])()],et.prototype,"close",void 0),Z([Object(s["Prop"])()],et.prototype,"showLoading",void 0),Z([Object(s["Prop"])()],et.prototype,"billToEdit",void 0),Z([Object(r["a"])(c["b"].loadOrganizationData,{namespace:c["d"]})],et.prototype,"loadOrganizationData",void 0),Z([Object(r["b"])(c["c"].getOrganizationData,{namespace:c["d"]})],et.prototype,"organizationData",void 0),Z([Object(r["b"])(c["c"].getProducts,{namespace:c["d"]})],et.prototype,"products",void 0),Z([Object(r["b"])(c["c"].getCollaborators,{namespace:c["d"]})],et.prototype,"collaborators",void 0),Z([Object(r["a"])(c["b"].addBill,{namespace:c["d"]})],et.prototype,"addBill",void 0),Z([Object(r["a"])(c["b"].updateBill,{namespace:c["d"]})],et.prototype,"updateBill",void 0),Z([Object(r["a"])(H["a"].notify,{namespace:H["c"]})],et.prototype,"notify",void 0),et=Z([Object(s["Component"])({components:{MediaListEditor:D["a"],FilterSelect:x["a"],AddProductBillDialog:K,QEditor:X["a"]}})],et);var lt=et,it=lt,ot=l("eaac"),st=l("db86"),at=l("4e73"),nt=l("1c1c"),rt=l("66e5"),ct=l("4074"),dt=l("cb32"),ut=l("0016"),pt=l("7cbe"),bt=l("52ee"),mt=l("a370"),ht=l("7f67"),ft=Object($["a"])(it,C,O,!1,null,null,null),vt=ft.exports;M()(ft,"components",{QInput:Q["a"],QTable:ot["a"],QBtn:V["a"],QTd:st["a"],QMenu:at["a"],QList:nt["a"],QItem:rt["a"],QItemSection:ct["a"],QAvatar:dt["a"],QIcon:ut["a"],QPopupProxy:pt["a"],QDate:bt["a"],QCardSection:mt["a"]}),M()(ft,"directives",{ClosePopup:ht["a"]});var gt=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let yt=class extends s["Vue"]{constructor(){super(...arguments),this.showLoading=!1}onClose(){this.close&&this.close()}getTitle(){return this.billToEdit?"Edit bill":"Create bill"}};gt([Object(s["Prop"])({default:!1})],yt.prototype,"showModal",void 0),gt([Object(s["Prop"])()],yt.prototype,"close",void 0),gt([Object(s["Prop"])()],yt.prototype,"billToEdit",void 0),yt=gt([Object(s["Component"])({components:{AddBillEditor:vt,Dialog:U["a"]}})],yt);var wt=yt,Bt=wt,Pt=Object($["a"])(Bt,P,q,!1,null,null,null),qt=Pt.exports,Ct=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("Dialog",{attrs:{showModal:t.showModal,loading:t.showLoading,title:"View bill",close:function(){return t.onClose()},styleDialog:"width: 600px; max-width: 80vw"}},[l("template",{slot:"content"},[l("ViewerBill",{attrs:{bill:t.bill,close:function(){return t.onClose()},showLoading:function(e){return t.showLoading=e}}})],1)],2)},Ot=[],Dt=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("q-input",{staticClass:"q-mx-md q-mb-lg q-mt-md",attrs:{square:"",outlined:"",label:"Name",readonly:"",dense:""},model:{value:t.bill.name,callback:function(e){t.$set(t.bill,"name",e)},expression:"bill.name"}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",label:"Description",autogrow:"",readonly:"",dense:""},model:{value:t.bill.description,callback:function(e){t.$set(t.bill,"description",e)},expression:"bill.description"}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",value:t.bill.client.name,label:"Client",readonly:"",dense:""}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",dense:"",value:t.getFormatDate(t.bill.date.toString()),label:"Date",autogrow:"",readonly:""}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",value:t.getStatus(t.bill.status),label:"Status",readonly:"",dense:""}}),l("div",{staticClass:"q-px-md q-pb-sm",staticStyle:{width:"100%"}},[l("q-table",{attrs:{bordered:"",flat:"",title:"",data:Object.values(t.billProducts).filter((function(t){return!t.remove})),columns:t.columns,"row-key":"productBillName","no-data-label":"Please, add some product to bill"},scopedSlots:t._u([{key:"top",fn:function(){return[l("div",{staticClass:"row q-col-gutter-none justify-between q-pa-none",staticStyle:{width:"100%"}},[l("div",{staticClass:"self-center"},[t._v("\n            Products\n          ")])])]},proxy:!0},{key:"loading",fn:function(){return[l("Loader",{attrs:{loading:!0}})]},proxy:!0}])})],1),t.bill.discount?l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",value:t.bill.discount,label:"Bill Total Price",readonly:"",autogrow:"",dense:""}}):t._e(),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",value:t.getPrice(),label:"Bill Total Price",readonly:"",autogrow:"",dense:""}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{dense:"",outlined:"",mask:"date",label:"Send date",readonly:""},model:{value:t.bill.sendDate,callback:function(e){t.$set(t.bill,"sendDate",e)},expression:"bill.sendDate"}}),l("q-input",{staticClass:"q-mx-md q-my-lg",attrs:{square:"",outlined:"",readonly:"",label:"Valid Days",type:"number",dense:""},model:{value:t.bill.validDays,callback:function(e){t.$set(t.bill,"validDays",e)},expression:"bill.validDays"}}),l("QEditor",{staticClass:"q-mx-md q-my-lg",attrs:{toEdit:t.bill,propToEdir:"observations",label:"Observations",readonly:!0}}),t.bill.docs&&t.bill.docs.length>0?l("MediaListViewer",{attrs:{title:"Bild documents",items:t.bill.docs,showLoading:t.showLoading}}):t._e(),l("q-card-section",{staticClass:"row items-center justify-center text-primary"},[l("q-btn",{staticClass:"col-12 col-sm-auto",attrs:{unelevated:"",color:"primary",align:"around",label:"Close"},on:{click:function(){return t.close()}}})],1)],1)},xt=[],jt=l("c1df"),St=l.n(jt),Et=l("e8aa"),kt=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let It=class extends s["Vue"]{constructor(){super(),this.billProducts={},this.columns=B,this.getStatus=d["c"],this.billProducts=this.getProducts()}getProducts(){const t={};return this.bill&&this.bill.products.forEach((e=>{const l=e.product;t[e.productId]=Object.assign(Object.assign({},e),{maxCount:e.count+(l?l.unitCount:0),type:l?l.type:1,remove:!1})})),t}getPrice(){const t=Object.values(this.billProducts).filter((t=>!t.remove)).map((t=>t.count*t.price)).reduce(((t,e)=>t+e),0),e=parseFloat(`${this.bill.discount}`);if(e){const l=Math.floor(t*e)/100;return`${t-l} ( ${t} )`}return t}getFormatDate(t){return St()(t).format("YYYY-MM-DD")}};kt([Object(s["Prop"])()],It.prototype,"close",void 0),kt([Object(s["Prop"])()],It.prototype,"showLoading",void 0),kt([Object(s["Prop"])({required:!0})],It.prototype,"bill",void 0),It=kt([Object(s["Component"])({components:{MediaListViewer:Et["a"],QEditor:X["a"]}})],It);var _t=It,Tt=_t,Lt=Object($["a"])(Tt,Dt,xt,!1,null,null,null),$t=Lt.exports;M()(Lt,"components",{QInput:Q["a"],QTable:ot["a"],QCardSection:mt["a"],QBtn:V["a"]});var Qt=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let At=class extends s["Vue"]{constructor(){super(...arguments),this.showLoading=!1}onClose(){this.close&&this.close()}};Qt([Object(s["Prop"])({default:!1})],At.prototype,"showModal",void 0),Qt([Object(s["Prop"])()],At.prototype,"close",void 0),Qt([Object(s["Prop"])({required:!0})],At.prototype,"bill",void 0),At=Qt([Object(s["Component"])({components:{ViewerBill:$t,Dialog:U["a"]}})],At);var Vt=At,Rt=Vt,Mt=Object($["a"])(Rt,Ct,Ot,!1,null,null,null),Nt=Mt.exports,Ft=l("b5ce");function Ut(t,e){return!e||(!e.client||-1!==t.client.name.toLowerCase().indexOf(e.client.toLowerCase()))&&(!e.status||t.status===e.status.value)}function zt(t,e){return t.filter((t=>Ut(t,e)))}var Yt=l("1239"),Wt=l("149f"),Jt=l("6602"),Gt=l("b06b"),Kt=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a},Ht=function(t,e,l,i){function o(t){return t instanceof l?t:new l((function(e){e(t)}))}return new(l||(l=Promise))((function(l,s){function a(t){try{r(i.next(t))}catch(e){s(e)}}function n(t){try{r(i["throw"](t))}catch(e){s(e)}}function r(t){t.done?l(t.value):o(t.value).then(a,n)}r((i=i.apply(t,e||[])).next())}))};let Xt=class extends s["Vue"]{constructor(){super(),this.filterBills=this.bills,this.statusOptions=Object(d["b"])(),this.loading=!1,this.columns=v,this.showAddBillDialog=!1,this.showConfirmStatusDialog=!1,this.showViewBillDialog=!1,this.selectedBill=null,this.textConfirm="",this.clientBill="",this.isToPay=!1,this.filterBills=this.bills?this.bills:[],this.filter=this.getFilterStore()||{client:""},this.filter&&(this.clientBill=this.filter.client)}showEditBillDialog(t){return Ht(this,void 0,void 0,(function*(){if(t){this.loading=!0;const e=t?yield this.loadDetails(t):t;this.loading=!1,this.selectedBill=e}else this.selectedBill=t;this.showAddBillDialog=!0}))}showBillDialog(t){return Ht(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.loadDetails(t);this.loading=!1,this.selectedBill=e,this.showViewBillDialog=!0}))}setfilterBills(){localStorage.setItem(Yt["a"].KEY_BILLS_FILTER,JSON.stringify(this.filter)),this.filterBills=zt(this.bills,this.filter)}setNameFilter(t){this.filter=Object.assign(Object.assign({},this.filter),{client:t})}setStatus(t){this.filter=Object.assign(Object.assign({},this.filter),{status:t||void 0})}getFilterStore(){const t=localStorage.getItem(Yt["a"].KEY_BILLS_FILTER);return t?JSON.parse(t):null}setConfirmStatusDialog(t,e){this.selectedBill=t,this.isToPay=e,this.textConfirm=`Are you sure you want to change the status to "${e?"payed":"cancelled"}"?`,this.showConfirmStatusDialog=!0}sendBillLink(t){return Ht(this,void 0,void 0,(function*(){t&&t.client&&t.client.email?(this.loading=!0,(yield this.sendBillEmail(t))?this.notify({message:"Bill sended successfully ",type:"positive"}):this.notify({message:"Send bill fail",type:"negative"}),this.loading=!1):this.notify({message:"Client email property is empty",type:"negative"})}))}loadBillPreview(t){return Ht(this,void 0,void 0,(function*(){if(t&&t.client){this.loading=!0;const e=yield this.getBillPreview(t);e?Object(Gt["a"])(e):this.notify({message:"Preview bill link fail",type:"negative"}),this.loading=!1}else this.notify({message:"Client property is empty",type:"negative"})}))}changeStatus(t){return Ht(this,void 0,void 0,(function*(){this.showConfirmStatusDialog=!1,t&&this.selectedBill&&(this.loading=!0,(yield(this.isToPay?this.changeStatusToPayed:this.changeStatusToCancelled)({id:this.selectedBill.id}))&&this.notify({message:"Bill status changed successfully ",type:"positive"}),this.loading=!1)}))}goToBillTemplate(){this.$router.push(Jt["d"].billTemplatePage.url)}mounted(){return Ht(this,void 0,void 0,(function*(){this.loading=!0,yield this.loadOrganizationData(),yield this.loadData(!1),yield this.loadProducts(!1),yield this.loadCollaborators(!1),this.setfilterBills(),this.loading=!1}))}};Kt([Object(r["a"])(c["b"].loadBills,{namespace:c["d"]})],Xt.prototype,"loadData",void 0),Kt([Object(r["a"])(c["b"].loadOrganizationData,{namespace:c["d"]})],Xt.prototype,"loadOrganizationData",void 0),Kt([Object(r["a"])(c["b"].loadBillDetail,{namespace:c["d"]})],Xt.prototype,"loadDetails",void 0),Kt([Object(r["a"])(c["b"].changeStatusToPayed,{namespace:c["d"]})],Xt.prototype,"changeStatusToPayed",void 0),Kt([Object(r["a"])(c["b"].changeStatusToCancelled,{namespace:c["d"]})],Xt.prototype,"changeStatusToCancelled",void 0),Kt([Object(r["a"])(c["b"].sendBillLink,{namespace:c["d"]})],Xt.prototype,"sendBillEmail",void 0),Kt([Object(r["a"])(c["b"].getBillPreview,{namespace:c["d"]})],Xt.prototype,"getBillPreview",void 0),Kt([Object(r["a"])(c["b"].loadProducts,{namespace:c["d"]})],Xt.prototype,"loadProducts",void 0),Kt([Object(r["a"])(c["b"].loadAllCollaborators,{namespace:c["d"]})],Xt.prototype,"loadCollaborators",void 0),Kt([Object(r["b"])(c["c"].getBills,{namespace:c["d"]})],Xt.prototype,"bills",void 0),Kt([Object(r["b"])(Ft["a"].USER_LOGGED_GETTER,{namespace:Ft["a"].USER_NAMESPACE})],Xt.prototype,"userLogged",void 0),Kt([Object(r["a"])(H["a"].notify,{namespace:H["c"]})],Xt.prototype,"notify",void 0),Kt([Object(s["Watch"])("filter"),Object(s["Watch"])("bills")],Xt.prototype,"setfilterBills",null),Kt([Object(s["Watch"])("clientBill")],Xt.prototype,"setNameFilter",null),Xt=Kt([Object(s["Component"])({components:{AddBillEditorDialog:qt,ViewerBillDialog:Nt,FilterSelect:x["a"],ConfirmDialog:Wt["a"]}})],Xt);var Zt=Xt,te=Zt,ee=(l("499c"),l("eb85")),le=l("65c6"),ie=Object($["a"])(te,a,n,!1,null,"528afad8",null),oe=ie.exports;M()(ie,"components",{QTable:ot["a"],QBtn:V["a"],QInput:Q["a"],QTd:st["a"],QMenu:at["a"],QList:nt["a"],QItem:rt["a"],QItemSection:ct["a"],QAvatar:dt["a"],QSeparator:ee["a"],QToolbar:le["a"]}),M()(ie,"directives",{ClosePopup:ht["a"]});var se=function(t,e,l,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,l):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(t,e,l,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,l,a):o(e,l))||a);return s>3&&a&&Object.defineProperty(e,l,a),a};let ae=class extends s["Vue"]{};ae=se([Object(s["Component"])({components:{Bills:oe}})],ae);var ne=ae,re=ne,ce=Object($["a"])(re,i,o,!1,null,null,null);e["default"]=ce.exports},8597:function(t,e,l){}}]);